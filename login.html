<!doctype html>
<html lang="en-US">
<head>
  <meta charset="utf-8">
  <meta http-equiv="Content-Type" content="text/html">
  
  <meta name="author" content="Jake Rocheleau">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
  <meta content="" name="description">
  <meta name="keywords" content="Mobile, android" />
  <title>Welcome To Healthlandling</title>
  <link rel="shortcut icon" type="image/x-icon" href="favicon.ico">
  <link rel="stylesheet" type="text/css" href="assets/css/owl.carousel.css" media="screen">
  <link href="https://fonts.googleapis.com/css?family=Abel%7CSource+Sans+Pro:400,700%7CTitillium+Web:300,400,600,700" rel="stylesheet">
  <link rel="stylesheet" type="text/css" href="assets/css/global.css" media="screen">
  <link rel="stylesheet" type="text/css" href="assets/css/style.css" media="screen">
  <link rel="stylesheet" type="text/css" href="assets/css/responsive.css" media="screen">
    <!--[if lt IE 9]>
    <link rel="stylesheet" type="text/css" href="assets/css/ie8.css" media="screen">
    <![endif]-->

  <script type="text/javascript" src="js/jquery-1.10.2.min.js"></script>
</head>
<body>
     <!--Page Wrapper Start-->
    <div id="wrapper" class="inner-page">
      <!--Header Section Start-->
      <header id="header" >
        <div class="container clearfix">
          <div class="nav-wrap clearfix">
            <h2  >HealthLandling</h2>
            <a href="index.html" class="menu-btn" href="javascript:void(0)"> <i> </i> <i> </i> <i> </i> </a>

          </div>
        </div>
      </header>
      <!--Header Section End-->

      <!--Content Area Start-->
      <div id="Content" style="background-color:rgba(0,0,0,0.6);">
        <!--import Section End-->

        <!--Cloud Section Start-->
        <section class="cloud-wrap">
          <!--container Section Start-->
          <div class="container clearfix">
            <div id="ghapidata" class="clearfix"></div>
            <div class="view-data-block">
              <div id="w">
                <h1>Connexion</h1>
              
                <input type="text" name="ghusername" id="ghusername" class="fieldtype" placeholder="username ...">
                <input type="password" name="ghuserpassword" id="ghuserpassword" class="fieldtype" placeholder="password ...">
                <a href="#" class="ghsubmitbtn " id="ghsubmitbtn">Login</a>
                <a href="index.html" style="margin-left: 10px; font-size: 16px; color:#fff;" >Cancel</a>
                
               
              </div>
            </div>
          </div>

          <!--container Section End-->
        </section>
      </div>
      <!--Content Area End-->

      <!--Footer Section Start-->
      <footer id="footer">

        <div class="primary-footer ">
          <!--container Section Start-->
          <div class="container clearfix">
            <nav>
              <h4>About Us</h4>
              <p id="aboutus">
                Ce produit est construit par AKAKPO Koffi Daniel, DOLA Koami, EGBENDEWE Komi Joseph
                dans le cadre du Projet tuteure dans le curcus du Master International

              </p>
            </nav>

            <nav>
              <h4>Quick Links</h4>
              <ul class="quick-link">
                <li>
                  <a href="index.html">Home</a>
                </li>

                <li>
                  <a href="javascript:void(0)" data-id="#contact">Contact Us</a>
                </li>
              </ul>
            </nav>

            
            <div class="social-wrap">
              <!-- <h4>Connect with Us</h4>
              <ul class="social-icon clearfix">
                <li>
                  <a href="#" class="icon-social-one" ></a>
                </li>
                <li>
                  <a href="#" class="icon-social-two" ></a>
                </li>
                <li>
                  <a href="#" class="icon-social-three" ></a>
                </li>
                <li>
                  <a href="#" class="icon-social-four" ></a>
                </li>
              </ul> -->
            </div>

          </div>
          <!--container Section End-->
        </div>
        

      </footer>
      <!--Footer Section End-->

    </div>

<script type="text/javascript">

  $(function(){
    $('#ghsubmitbtn').on('click', function(e){
      e.preventDefault();
      $('#ghapidata').html('<div id="loader"><img src="css/loader.gif" alt="loading..."></div>');
      
      var username = $('#ghusername').val();
      //var requri   = 'http://192.168.1.32:9000/v1/users/login';
      var requri   = 'http://localhost:9000/v1/users/login';

      var requestData = {
        credentials:{
          name: $('#ghusername').val(),
          password: $('#ghuserpassword').val()
        }
      };
      requestJSON(requri, requestData, function(json) {
        if(json.message == "Not Found") {
          $('#ghapidata').html("<h2>No User Info Found</h2>");
        }
        
        else {
          // else we have a user and we display their info
          console.log(json);
          var user_id   = json.user_id;
          var token   = json.token;
            
          if(token !== null || token !== undefined){
            persist("token", token); 
            var newuri   = "http://localhost:9000/v1/users/" + token.user_id;
            requestUserJSON(newuri, function(userjson){
                if(json.message == "Not Found") {
                  $('#ghapidata').html("<h2>No User Info Found</h2>");
                }
                console.log(userjson);
                var user = userjson;
                persist("user", user);
                if(user.type === "patient"){
                  location.replace("patients.html");
                } else if(user.type === "medecin"){
                  location.replace("medecins.html");
                }
                
            });
          } else{
            $('#ghapidata').html("<h2>No User Info Found</h2>");
          }
        } // end else statement
      }); // end requestJSON Ajax call
    });
  }); // end click event handler

  function requestUserJSON(url, callback) {

    $.ajaxSetup({
      headers: {
        'Content-Type': "application/json"
        }
    });
    
    $.ajax({
      url: url,
      complete: function(xhr) {
        callback.call(null, xhr.responseJSON);
      }
    });
  };

  function requestJSON(url, reqData, callback) {

    $.ajaxSetup({
      headers: {
        'Content-Type': "application/json"
        }
    });
    
      $.ajax({
        type: "POST",
        url: url,
        data: JSON.stringify(reqData),
        complete: function(xhr) {
          callback.call(null, xhr.responseJSON);
        }
      });
  };

  function persist(key, item) {
    localStorage.setItem(key, item);
  };

  function get(key) {
    return localStorage.getItem(key);
  };
</script>
</body>
</html>